{{define "base"}}
<!doctype html>
<html lang='en'>
    <head>
        <meta charset='utf-8'>
        <title>Home - PixBlur</title>
        <link rel='stylesheet' href='/static/css/main.css'>
        <link rel='shortcut icon' href='/static/img/favicon.ico' type='image/x-icon'>
        <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700'>
        <script src="https://unpkg.com/htmx.org@2.0.4" integrity="sha384-HGfztofotfshcF7+8n44JQL2oJmowVChPTg48S+jvZoztPfvwD79OC/LTtG6dMp+" crossorigin="anonymous"></script>
        <script src="https://unpkg.com/htmx.org@1.9.12/dist/ext/ws.js"></script>
        <script src="https://unpkg.com/htmx.org@1.9.12/dist/ext/sse.js"></script>
        <!-- <script src="/statis/js/main.js"></script> -->
        <script>
            const eventSource = new EventSource('http://localhost:4000/events');
            
            eventSource.onmessage = function(event) {
                const timerValue = event.data  // The image file path sent from the server

                const imageElement = document.getElementById('live-image');
                const timerElement = document.getElementById('timer');
            
                timer.textContent = parseInt(timerValue, 10);
                
                // Update the image source with the new image
                console.log(imageElement.src.split('?')[0] + '?' + new Date().getTime());
                imageElement.src = imageElement.src.split('?')[0] + '?' + new Date().getTime();  // Adding a timestamp to avoid caching issues
            };
            
            eventSource.onerror = function(error) {
                eventSource.close();
                console.error('Eventsource error:', error);
            };
        </script>
    </head>
    <body>
        <header>
            <h1>PixBlur</h1>
        </header>
        <main>
            <div id="game-container">
                <div id="win-message" class="win-message hidden">YOU WIN!!!</div>
                <div id="timer" class="timer">00</div>
                <div class="img-container">
                    <img src='static/img/temp_blurred_image.png' alt='Blur' id='live-image'>
                </div>
                <div id="keys-letters-container">
                {{template "keyboard" .}}
                </div>
            </div>
        </main>
        <footer>Powered by <a href='https://golang.org/'>Go</a></footer>
        <script src='/static/js/main.js' type='text/javascript'></script>
    </body>
</html>
{{end}}